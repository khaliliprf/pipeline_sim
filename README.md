

## ๐ ุชูุงุจุน ุงุตู ฺฉูุงุณ `Pipeline`

---

### โ `__init__(...)`

**ูุฏู:** ููุฏุงุฑุฏู ุงููู ุจู ุชูุงู ูฺฺฏโูุง ูพุงูพโูุงู

* `instructions`: ูุณุช ุงููู ุฏุณุชูุฑุงุช (ูุณุช ุงุฒ ุงุดุง Instruction).
* `enable_forwarding`: ูุดุฎุต ูโฺฉูุฏ ููุฑูุงุฑุฏูฺฏ ูุนุงู ุจุงุดุฏ ุง ูู.
* ุดูุงุฑูุฏูโูุง ุขูุงุฑ: `stall_count`, `flush_count`, `forward_count`, `structural_stalls`.
* `pipeline_registers`: ุฏฺฉุดูุฑ ต ุงุณุชุฌ (IF, ID, EX, MEM, WB).
* `pipeline_matrix`: ุฐุฎุฑูโ ุฒูุงู ู ูฺฉุงู ุนุจูุฑ ูุฑ ุฏุณุชูุฑ ุฏุฑ ูพุงูพโูุงู.
* `completed_instructions`: ูุณุช ุฏุณุชูุฑุงุช ฺฉู ูุงุฑุฏ WB ุดุฏูโุงูุฏ.
* `input_instructions_count`: ุชุนุฏุงุฏ ุฏุณุชูุฑุงุช ุงูููุ ุจุฑุง ฺฏุฒุงุฑุด ููุง.

---

### โ `log_pipeline_stage(instr, stage)`

**ูุฏู:** ุซุจุช ุงูฺฉู ฺฉ ุฏุณุชูุฑ ุฏุฑ ฺฉุฏุงู ฺฉูุงฺฉ ูุงุฑุฏ ฺฉุฏุงู ุงุณุชุฌ ุดุฏู ุงุณุช.

* ุงฺฏุฑ ุฏุณุชูุฑ ุงููู ุจุงุฑ ุฏุฏู ูโุดูุฏุ ฺฉ ูุฑูุฏ ุจุฑุงุด ุฏุฑ `pipeline_matrix` ุงุฌุงุฏ ูโุดูุฏ.
* ุณูพุณ ููุฏุงุฑ `stage` ุจุฑุง `self.clock` ุฏุฑ ุขู ุซุจุช ูโุดูุฏ.

---

### โ `has_raw_hazard(curr_instr)`

**ูุฏู:** ุจุฑุฑุณ ูุงุจุณุชฺฏ ุฏุงุฏูโุง ุงุฒ ููุน RAW (Read After Write)

* `sources`: ุฑุฌุณุชุฑูุง ูุฑูุฏ ุฏุณุชูุฑ ูุนู (`rs`, `rt`)
* ุจุฑุง ูุฑ ุงุณุชุฌ ุฌููุชุฑ (EX, MEM, WB)ุ ุจุฑุฑุณ ูโุดูุฏ ฺฉู ุขุง ููุตุฏ ฺฉ ุฏุณุชูุฑ ูุจู ุจุง ฺฉ ุงุฒ `sources` ุจุฑุงุจุฑ ุงุณุช ุง ูู.
* ุงฺฏุฑ `enable_forwarding` ูุนุงู ุจุงุดุฏ:

  * ุงฺฏุฑ ุฏุงุฏู ูููุฒ ุฏุฑ EX ุงุณุช ู ุฏุณุชูุฑ ูุจู `LW` ุจุงุดุฏ: ุงุณุชุซูุง โ ูุงุฒ ุจู ุงุณุชุงู
  * ุฏุฑ ุบุฑ ุงู ุตูุฑุช โ ููุฑูุงุฑุฏ ุงูุฌุงู ูโุดูุฏ ู `forward_count` ุงูุฒุงุด ูโุงุจุฏ.
* ุงฺฏุฑ ููุฑูุงุฑุฏูฺฏ ุบุฑูุนุงู ุจุงุดุฏ โ ุงุณุชุงู ุถุฑูุฑ ุงุณุช.

---

### โ `tick()`

**ูุฏู:** ุดุจูโุณุงุฒ ฺฉ ุณฺฉู ฺฉูุงฺฉ ูพุงูพโูุงู

1. **ุงูุฒุงุด ุดูุงุฑูุฏู ฺฉูุงฺฉ**

2. **ูุฑุญูู WB:**

   * ูุฑ ุฏุณุชูุฑ ฺฉู ุฏุฑ `WB` ูุณุช ุจู ุนููุงู ุชูุงูโุดุฏู ุนูุงูุชโฺฏุฐุงุฑ ูโุดูุฏ.
   * ุจู ูุณุช `completed_instructions` ุงุถุงูู ูโุดูุฏ.
   * ูพุงฺฉโุณุงุฒ ุงุณุชุฌ WB ุจุฑุง ฺฉูุงฺฉ ุจุนุฏ.

3. **ุฌุงุจูโุฌุง ูุฑุงุญู:**

   * `MEM โ WB`
   * `EX โ MEM`

4. **ุจุฑุฑุณ ุงุณุชุฌ ID ุจุฑุง ุฑูุชู ุจู EX:**

   * ุงฺฏุฑ ุฏุณุชูุฑ `BEQ` ุจุงุดุฏ ู ุดุฑุท branch ุจุฑูุฑุงุฑ ูุจุงุดุฏ:

     * ุชูุงู ุฏุณุชูุฑุงุช ููุฌูุฏ ุฏุฑ `IF` ู `ID` ุญุฐู (flush)
     * ุดูุงุฑุด `flush_count`
   * ุงฺฏุฑ hazard ููุฌูุฏ ุจุงุดุฏ:

     * ุงุณุชุงู ุฏุฑ EX
     * ุงูุฒุงุด `stall_count`
   * ุฏุฑ ุบุฑ ุงู ุตูุฑุช:

     * ุงูุชูุงู ุฏุณุชูุฑ ุงุฒ `ID โ EX`

5. **ุจุฑุฑุณ ุงูฺฉุงู ุขูุฑุฏู ุฏุณุชูุฑ ุฌุฏุฏ ุจู IF ู ุงูุชูุงู ุจู ID:**

   * ุดุฑุท `can_fetch_new` ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู:

     * ุง ID ุฎุงู ุจุงุดุฏุ ุง ุฏุณุชูุฑ ุฏุฑ ID ุจุฏูู hazard ุจุงุดุฏ.
   * ุงฺฏุฑ ุงูฺฉุงู ุจุงุดุฏ:

     * ุฏุณุชูุฑ ุจุนุฏ ุงุฒ `instructions` ูุงุฑุฏ IF ูโุดูุฏ.
     * ุณูพุณ `IF โ ID` ูโุดูุฏ.

6. **ุซุจุช ูุถุนุช ููู ุฏุณุชูุฑุงุช ุฏุฑ ูุงุชุฑุณ ูพุงูพโูุงู**

---

### โ `is_done()`

**ูุฏู:** ุจุฑุฑุณ ุงูฺฉู ุงุฌุฑุง ุชูุงู ุฏุณุชูุฑุงุช ุจู ูพุงุงู ุฑุณุฏู ุง ูู

* ุจุง ุจุฑุฑุณ ุงูฺฉู ุขุง ุชุนุฏุงุฏ ุฏุณุชูุฑุงุช ฺฉุงููโุดุฏู ุจุฑุงุจุฑ ุจุง ฺฉู ุชุนุฏุงุฏ ุฏุณุชูุฑูุง (ู ูุถุนุช ุงุณุชุฌโูุง) ุงุณุช ุง ูู.

---

### โ `total_instruction_count()`

**ูุฏู:** ุฌูุน ฺฉู ุฏุณุชูุฑุงุช ฺฉู ุง ูููุฒ ุงุฌุฑุง ูุดุฏูโุงูุฏ ุง ุฏุฑ ุญุงู ุงุฌุฑุง ูุณุชูุฏ ุง ุงุฌุฑุง ุดุฏูโุงูุฏ.

---

### โ `run(...)`

**ูุฏู:** ุงุฌุฑุง ูพุงูพโูุงู ุชุง ุงุชูุงู ุจุฑูุงูู ุง ุฑุณุฏู ุจู ุญุฏุงฺฉุซุฑ ฺฉูุงฺฉ

* ุฏุฑ ฺฉ ุญููู `while`ุ ูุฑุชุจุงู `tick()` ูุฑุงุฎูุงู ูโุดูุฏ.
* ุณูพุณ ูุงุชุฑุณ ููุง ู ุขูุงุฑ ฺุงูพ ูโุดูุฏ.
* ุฏุงุฏูโูุง ุจุฑุง ุฑุณู ฺฏุฑุงู ููุง ุจู `export_simulation_image` ูุฑุณุชุงุฏู ูโุดููุฏ.

---

### โ `print_stats()`

**ูุฏู:** ฺุงูพ ุขูุงุฑ ููุง ุงุฌุฑุง ุจุฑูุงูู

* ุดุงูู: total cycles, number of instructions, stalls, flushes, forwards, CPI

---

### โ `print_pipeline_matrix()`

**ูุฏู:** ฺุงูพ ุฌุฏูู ูพุงูพโูุงู ุจูโุตูุฑุช ูุชู

* ุณุทุฑ ุงูู: ุดูุงุฑู ฺฉูุงฺฉโูุง
* ูุฑ ุณุทุฑ ุจุนุฏ: ูุฑุงุญู ุงุฌุฑุง ฺฉ ุฏุณุชูุฑ
* ุงฺฏุฑ ุฏุณุชูุฑ flush ุดุฏู ุจุงุดุฏ โ `--` ุฏุฑ ุฌุฏูู

---